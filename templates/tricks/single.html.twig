{% extends '/layout.html.twig' %}

{% block title %}SnowTricks - View Trick : {% endblock %}

{% block content %}
    
    <div class="single-tricks-page">

        <div class="ftco-section tricks-list">

            <div id='js-media-list-container'>
              {% if 'add' not in app.request.uri %}
                {{ include('tricks/_media_list.html.twig') }}
              {% endif %}
            </div>

            <!-- delete confirmation window -->
            <div id="trick-delete-content" class="form-group">

                <div class="title">DELETE TRICK</div>
                <div class="subtitle">Delete a trick</div>

                <div class="min-height">

                    {% for message in app.flashes('delete-trick-error') %}
                        <div class="alert alert-danger">
                            {{ message }}
                        </div>
                    {% endfor %}

                    {% for message in app.flashes('delete-trick-success') %}
                        <div class="alert alert-success">
                            {{ message }}
                        </div>
                    {% endfor %}

                    <p>Are you sure you want to delete this trick ?</p>
                    <div class="delete-media-control">
                        <button type="submit" id="delete-trick-confirm" class="btn py-3 px-4 btn-danger" data-url="{{ path('edit_trick', {trickSlug: trick.slug, action: 'confirm_deletion'}) }}">Delete trick</button>
                        <button type="submit" id="delete-trick-cancel" class="btn py-3 px-4 btn-primary">Cancel</button>
                    </div>

                </div>

            </div>
            <!-- delete confirmation window -->


            {% if is_granted('IS_AUTHENTICATED_FULLY') and ('edit' in app.request.uri or 'add' in app.request.uri) %}

                <!-- trick edit form start -->
                <section class="container bg-light content">

                  <div class="row d-flex">

                    <div class="col ftco-animate text-left edit-trick-form">

                      {% if 'add' in app.request.uri %}
                        <div class="title">ADD A TRICK</div>
                        <div class="subtitle">Please fill the requested fields to create the trick.</div>
                      {% endif %}                     

                      {{ form_start(form, {'action': '#form'}) }}

                        {% for message in app.flashes('trick-success') %}
                            <div class="alert alert-success">
                              {{ message }}
                          </div>
                        {% endfor %}

                        {% for message in app.flashes('trick-error') %}
                          <div class="alert alert-danger">
                                  {{ message }}
                          </div>
                        {% endfor %}

                        {{ form_widget(form) }}
                        
                        <div class="col text-right edit-trick-submit">
                          {% if 'edit' in app.request.uri %}
                            <button type="submit" class="btn py-3 px-4 btn-danger js-delete-trick">Delete</button>
                          {% else %}
                            <button type="button" class="btn py-3 px-4 btn-dark" id="js-cancel-trick" data-url="{{ path('tricks') }}">Cancel</button>
                          {% endif %}
                          <button type="submit" class="btn py-3 px-4 btn-primary" id="js-save-trick-button">Save</button>
                        </div>

                      {{ form_end(form) }}

                    </div>

                  </div>

                </section>
                <!-- trick edit form end -->

              {% else %}

                <!-- description start -->
                <section class="container bg-light content">

                  <div class="row">
                    <div class="col-lg ftco-animate description">
                      {{ trick.description }}
                    </div>
                  </div>

                  <div class="row trick-creation-info">
                    <div class="col ftco-animate">
                      <b>Created</b><br />{{ trick.creationDate|date("M d, Y \\a\\t g:ia") }}
                    </div>
                    {% if trick.modificationDate is not null %}
                      <div class="col ftco-animate">
                        <b>Modified</b><br />{{ trick.modificationDate|date("M d, Y \\a\\t g:ia") }}
                      </div>
                    {% endif %}                
                    <div class="col ftco-animate">
                      <b>Author</b><br />{{ trick.user.userName }}
                    </div>
                    <div class="col ftco-animate">
                      <b>Category</b><br /><a href="/tricks/{{ trick.category.slug }}">{{ trick.category.name }}</a>
                    </div>
                  </div>

                </section>
                <!-- description end -->


                <!-- comments start -->
                <section class="container bg-light content">
                  <div class="row">

                    <div class="pt-5 mt-5 comments-section">

                      <div class="comment-form-wrap pt-5 leave-comment">
                        <form action="#" class="bg-light p-4">
                          <div class="form-group">
                            <label for="message">Message</label>
                            <textarea name="" id="message" cols="30" rows="3" class="form-control"></textarea>
                          </div>
                          <div class="form-group">
                            <input type="submit" value="Leave a comment" class="btn py-3 px-4 btn-primary">
                          </div>
                        </form>                    
                      </div>

                      <h2 class="mb-5">{{ trick.comments.count }} comments</h3>
                      <ul class="comment-list">
                        <div id="js-comment-list">
                        </div>
                      </ul>
                      
                    </div>
                  </div>

                  <div class="row d-flex load-more load-more-ajax load-more-comment">
                      <div id="js-load-more-comment" class="btn btn-load-more">
                          <div class="loader">
                              <svg version="1.1" id="loader-1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="40px" height="40px" viewbox="0 0 50 50" style="enable-background:new 0 0 50 50;" xml:space="preserve">
                                  <path fill="#000" d="M43.935,25.145c0-10.318-8.364-18.683-18.683-18.683c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615c8.072,0,14.615,6.543,14.615,14.615H43.935z">
                                      <animateTransform attributetype="xml" attributename="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatcount="indefinite"/>
                                  </path>
                              </svg>
                          </div>
                          <div class='txt'>Load more</div>
                      </div>
                  </div>

                  <div id='js-load-parameters' data-trick="{{ trick.id }}" data-first-result="0" data-max-results="{{ constant('App\\Entity\\Comment::NUM_ITEMS') }}" data-total-results="{{ trick.comments.count }}" data-order-by="creationDate-ASC"></div>
            
                </section>
                <!-- comments end -->


              {% endif %}


        </div>

    </div>


{% endblock %}
